<!-- @format -->

<!doctype html>
<html>
	<body>
		<h1>hola mundo</h1>

		<pre id="code" style="margin: 10px"></pre>

		<script>
			class Person {
				constructor() {
					this.dispatch = undefined;
					this.isAwake = true;
					this.isEating = false;
					this.isTalking = false;
					this.isSleeping = false;
				}

				sleep() {
					alert("sleep");
				}

				talk() {
					alert("talk");
				}

				eat() {
					alert("eat");
				}

				wakeUp() {
					alert("wakeUp");
				}
			}

			const newObj = {
				isTyping: false,
				text: "",
				name: "Luis Eduardo",
				signature: "Luis E.F.",
				age: 13,
				skill: ["c#", "react", "nextjs"],
				hasLicense: false,
				hasPension: false,
				person: new Person()
			};

			function Clone(obj) {
				const clonedObj = { ...JSON.parse(JSON.stringify(obj)) };
				addMethods(clonedObj, obj);
				return clonedObj;
			}

			function addMethods(clonedObj, originalObj) {
				for (let prop in originalObj) {
					if (Array.isArray(originalObj[prop])) {
						clonedObj[prop] = originalObj[prop].slice();
					} else if (
						typeof originalObj[prop] === "object" &&
						typeof originalObj[prop] !== "function" &&
						originalObj[prop] !== null
					) {
						clonedObj[prop] = {};
						addMethods(clonedObj[prop], originalObj[prop]);
					} else if (
						typeof originalObj[prop] === "function" &&
						prop !== "constructor"
					) {
						clonedObj[prop] = originalObj[prop].bind(clonedObj);
					} else {
						clonedObj[prop] = originalObj[prop];
					}
				}
				const prototype = Object.getPrototypeOf(originalObj);
				if (prototype !== null) {
					const prototypeMethods = Object.getOwnPropertyNames(prototype);
					prototypeMethods.forEach(prop => {
						if (
							typeof prototype[prop] === "function" &&
							prop !== "constructor"
						) {
							clonedObj[prop] = prototype[prop].bind(clonedObj);
						}
					});
				}
			}

			let newObjClone;

			try {
				newObjClone = Clone(newObj);
				alert("-despues de clonado-");
			} catch (err) {
				alert(arr);
			}

			try {
				alert("----");
				newObjClone.person.sleep();
				alert("-$$$$$$");
			} catch (err) {
				alert(err);
			}
		</script>
	</body>
</html>

/*

/** @format */

const newObj = {
	name: "Alice",
	age: 25,
	isJob: false,
	address: {
		calle: "calle x",
		number: 25,
		sector: "la cañita",
		changeSector: value => {
			this.sector = value;
		},
		changeNumber: value => {
			this.number = value;
		},
		changeCalle: value => {
			this.calle = value;
		}
	},
	data: {
		cedula: "272727",
		licencia_activa: false,
		universidad: {
			name: "uasd",
			age: 3,
			materias: ["matematica","español"],
			agregar_materia:(value)=>{
				this.materias.push(value)
			}
		},
		activar_licencia: () => {
			this.licencia_activa = true;
		}
	},
	changeDataCedula: value => {
		this.data.cedula = value;
	},
	changeAge: value => {
		this.age = value;
	},
	changeName: value => {
		this.name = value;
	}
};

function Clone(obj) {
	const keys = Reflect.ownKeys(obj);

	const dictionary = Object.values(obj).map((val, i) => {
		//Verifica si va no es null y no es un objecto, crear un objecto con el valor de val.
		if (val === null || typeof val !== "object") {
			return { key: keys[i], value: val };
		}

		//verifica si val es un array para evaluar valor por valor
		if (Array.isArray(val)) {
			const newArray = new Array(val.length);

			val.forEach((valu, i) => {
				if (typeof valu === "object" && valu !== null) {
					newArray[i] = Clone(valu);
				}
				newArray[i] = valu;
			});

			return { key: keys[i], value: newArray.slice() };
		}

		//si val es un objecto realiza reculsividad
		return { key: keys[i], value: Clone(val) };
	});

	const newObj = {};

	dictionary.forEach(o => {
		const _obj = o.value;

		if (typeof _obj === "object" && _obj !== null) {
			const newOtherObj = { ..._obj };

			const methods = Object.getOwnPropertyNames(_obj);
			const methodsH = Object.getOwnPropertyNames(Object.getPrototypeOf(_obj));

			const allMethods = methods.concat(methodsH);

			allMethods.forEach(method => {
				if (method !== "constructor")
					Reflect.set(newOtherObj, method, _obj[method]);
			});

			Reflect.set(newObj, o.key, newOtherObj);
		} else {
			Reflect.set(newObj, o.key, o.value);
		}
	});

	const newObj2 = { ...JSON.parse(JSON.stringify(newObj)) };

	const methods = Object.getOwnPropertyNames(obj);
	const methodsH = Object.getOwnPropertyNames(Object.getPrototypeOf(obj));

	const allMethods = methods.concat(methodsH);

	allMethods.forEach(method => {
		if (method !== "constructor" && typeof obj[method] === "function")
			Reflect.set(newObj2, method, obj[method]);
	});

	return newObj2;
}

const newObjClone = Clone(newObj);

// Modificar los clones
newObjClone.name = "Jose";
newObjClone.age = 555;
newObjClone.isJob = true;
newObjClone.numbers = ["a", "b", "c"];

newObjClone.address.name = "Carlos";
newObjClone.address.ag = 888;
newObjClone.address.isJob = true;
newObjClone.address.numbers = ["%", "&", "@"];

newObjClone.data.info.name = "Maicor";
newObjClone.data.info.age = 333;
newObjClone.data.info.isJob = true;
newObjClone.data.info.numbers = ["@", 5, true];
newObjClone.changeAge();

// Mostrar los objetos en el elemento <pre>
const code = document.querySelector("#code");

code.textContent += "-----original-------\n\n";

code.textContent += JSON.stringify(newObj, null, 2) + "\n";

code.textContent += "-----clone-------\n\n";

code.textContent += JSON.stringify(newObjClone, null, 2) + "\n";

//////////


class Person {

							constructor() {
								this.dispatch = undefined;
								this.isAwake = true;
								this.isEating = false;
								this.isTalking = false;
								this.isSleeping = false;
							}

							sleep() {
								try {
									this.dispatch({
										type: "update_Person",
										value: {
											isSleeping: true,
											isAwake: false,
											isTalking: false,
											isEating: false
										}
									});
								} catch (err) {
									alert(err);
								}
							}

							talk() {
								try {
									if (this.isAwake) {
										this.dispatch({
											type: "update_Person",
											value: { isTalking: true, isEating: false }
										});
									} else alert("You are sleeping");
								} catch (err) {
									alert(err);
								}
							}

							eat() {
								try {
									if (this.isAwake) {
										this.dispatch({
											type: "update_Person",
											value: { isEating: true, isTalking: false }
										});
									} else alert("You are sleeping");
								} catch (err) {
									alert(err);
								}
							}

							wakeUp() {
								try {
									if (this.isSleeping)
										this.dispatch({
											type: "update_Person",
											value: { isAwake: true, isSleeping: false }
										});
								} catch (err) {
									alert(err);
								}
							}
						}



									const newObj =  {
								isTyping: false,
								text: "",
								name: "Luis Eduardo",
								signature: "Luis E.F.",
								age: 13,
								hasLicense: false,
								hasPension: false,
								person: new Person()
							};



									function Clone(obj) {
										const clonedObj = { ...JSON.parse(JSON.stringify(obj)) };
										addMethods(clonedObj, obj);
										return clonedObj;
									}

									function addMethods(clonedObj, originalObj) {
										for (let prop in originalObj) {
											if (Array.isArray(originalObj[prop])) {
												clonedObj[prop] = originalObj[prop].slice();
											} else if (
												typeof originalObj[prop] === "object" &&
												originalObj[prop] !== null
											) {
												clonedObj[prop] = Clone(originalObj[prop]);
												addMethods(clonedObj[prop], originalObj[prop]);
											}
											if (typeof originalObj[prop] === "function") {
												clonedObj[prop] = originalObj[prop].bind(clonedObj);
											}
										}
									}

									const newObjClone = Clone(newObj);

			try {
						//newObjClone.person.sleep();
					} catch (err) {
						alert(err);
					}

									// Mostrar los objetos en el elemento <pre>
									const code = document.querySelector("#code");

									code.textContent += "-----original-------\n\n";

									code.textContent += JSON.stringify(newObj, null, 2) + "\n";

									code.textContent += "-----clone-------\n\n";

									code.textContent += JSON.stringify(newObjClone, null, 2) + "\n";

									code.textContent += "-----clone-------\n\n";

									code.textContent += JSON.stringify(newObjClone2, null, 2) + "\n";

*/